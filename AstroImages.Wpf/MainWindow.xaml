<Window x:Class="AstroImages.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="{Binding WindowTitle}" Height="720" Width="1200" 
        MinWidth="800" MinHeight="600" 
        Icon="icon.ico"
        Background="{DynamicResource ThemeWindowBackground}"
        Foreground="{DynamicResource ThemeForeground}">
    <Window.InputBindings>
        <KeyBinding Key="O" Modifiers="Ctrl+Shift" Command="{Binding OpenFilesCommand}" />
    </Window.InputBindings>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Menu Bar -->
        <Menu Grid.Row="0">
            <MenuItem Header="File">
                <MenuItem Header="Open Folder..." Command="{Binding OpenFolderDialogCommand}" />
                <MenuItem Header="Open Recent" ItemsSource="{Binding RecentFolders}">
                    <MenuItem.Resources>
                        <Style TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
                            <Setter Property="Header" Value="{Binding}" />
                            <Setter Property="Command" Value="{Binding DataContext.OpenRecentFolderCommand, RelativeSource={RelativeSource AncestorType=Menu}}" />
                            <Setter Property="CommandParameter" Value="{Binding}" />
                            <Setter Property="Foreground" Value="{DynamicResource ThemeForeground}" />
                            <Setter Property="Background" Value="{DynamicResource ThemeMenuBackground}" />
                        </Style>
                    </MenuItem.Resources>
                </MenuItem>
                <MenuItem Header="Open Files..." Click="OpenFiles_Click" InputGestureText="Ctrl+Shift+O" />
                <Separator />
                <MenuItem Header="Move Selected..." Command="{Binding MoveSelectedCommand}" />
                <Separator />
                <MenuItem Header="Exit" Click="Exit_Click" />
            </MenuItem>
            <MenuItem Header="View">
                <MenuItem Header="Full Screen" Command="{Binding EnterFullScreenCommand}" InputGestureText="F11"/>
            </MenuItem>
            <MenuItem Header="Options">
                <MenuItem Header="General" Command="{Binding ShowGeneralOptionsDialogCommand}" />
                <MenuItem Header="Custom keywords" Command="{Binding ShowCustomKeywordsDialogCommand}" />
                <MenuItem Header="FITS keywords" Command="{Binding ShowFitsKeywordsDialogCommand}" />
            </MenuItem>
            <MenuItem Header="Help">
                <MenuItem Header="Check for Updates" Click="CheckForUpdates_Click" />
                <Separator />
                <MenuItem Header="View Activity Log" Click="ViewLog_Click" />
                <Separator />
                <MenuItem Header="Documentation" Click="Documentation_Click" />
                <MenuItem Header="Feedback" Click="Feedback_Click" />
                <MenuItem Header="About" Click="About_Click" />
            </MenuItem>
        </Menu>
        
        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="200"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*" MinWidth="200"/>
            </Grid.ColumnDefinitions>

            <!-- Sidebar -->
            <Grid Grid.Column="0" Background="{DynamicResource ThemeSidebarBackground}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- File List with Scrollbar -->
                <ListView Name="FileListView" Grid.Row="0" Margin="4,4,4,0" FontSize="13"
                          Background="{DynamicResource ThemeListViewBackground}"
                          Foreground="{DynamicResource ThemeForeground}"
                          BorderBrush="{DynamicResource ThemeBorderBrush}">
                    <ListView.SelectedIndex>
                        <Binding Path="SelectedIndex" Mode="TwoWay"/>
                    </ListView.SelectedIndex>
                    <ListView.View>
                        <GridView>
                            <!-- Dynamic columns are created in code-behind -->
                        </GridView>
                    </ListView.View>
                </ListView>

                <!-- Control Section - Always at Bottom -->
                <Grid Grid.Row="1" Margin="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Move Selected Button - Left Aligned -->
                    <Button Name="MoveSelectedButton" Grid.Column="0" Content="Move selected..." 
                            Command="{Binding MoveSelectedCommand}" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0,4,8,4" />
                    
                    <!-- Navigation Buttons - Center Aligned -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="4">
                        <Button Name="GotoFirst" Width="40" Margin="2" Command="{Binding GotoFirstCommand}">
                            <Grid Width="20" Height="16">
                                <Rectangle Width="2" Height="14" Fill="{DynamicResource ThemeButtonForeground}" HorizontalAlignment="Left" Margin="2,0,0,0"/>
                                <Path Width="12" Height="14" Stretch="Uniform" Fill="{DynamicResource ThemeButtonForeground}" Data="M 10,2 L 2,8 L 10,14 Z" HorizontalAlignment="Right" Margin="0,0,2,0"/>
                            </Grid>
                        </Button>
                        <Button Name="GotoPrevious" Width="40" Margin="2" Command="{Binding GotoPreviousCommand}">
                            <Path Width="20" Height="20" Stretch="Uniform" Fill="{DynamicResource ThemeButtonForeground}" Data="M 15,2 L 5,10 L 15,18" />
                        </Button>
                        <Button Name="PlayPause" Width="40" Margin="2" Command="{Binding PlayPauseCommand}">
                            <ContentControl>
                                <ContentControl.Style>
                                    <Style TargetType="ContentControl">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <Path Width="20" Height="20" Stretch="Uniform" Fill="{DynamicResource ThemeButtonForeground}" Data="M 6,4 L 18,10 L 6,16 Z" />
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                                <Setter Property="Content">
                                                    <Setter.Value>
                                                        <Grid Width="16" Height="16">
                                                            <Rectangle Width="5" Height="14" Fill="{DynamicResource ThemeButtonForeground}" RadiusX="1" RadiusY="1" HorizontalAlignment="Left" Margin="2,0,0,0"/>
                                                            <Rectangle Width="5" Height="14" Fill="{DynamicResource ThemeButtonForeground}" RadiusX="1" RadiusY="1" HorizontalAlignment="Right" Margin="0,0,2,0"/>
                                                        </Grid>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ContentControl.Style>
                            </ContentControl>
                        </Button>
                        <Button Name="GotoNext" Width="40" Margin="2" Command="{Binding GotoNextCommand}">
                            <Path Width="20" Height="20" Stretch="Uniform" Fill="{DynamicResource ThemeButtonForeground}" Data="M 5,2 L 15,10 L 5,18" />
                        </Button>
                        <Button Name="GotoLast" Width="40" Margin="2" Command="{Binding GotoLastCommand}">
                            <Grid Width="20" Height="16">
                                <Path Width="12" Height="14" Stretch="Uniform" Fill="{DynamicResource ThemeButtonForeground}" Data="M 2,2 L 10,8 L 2,14 Z" HorizontalAlignment="Left" Margin="2,0,0,0"/>
                                <Rectangle Width="2" Height="14" Fill="{DynamicResource ThemeButtonForeground}" HorizontalAlignment="Right" Margin="0,0,2,0"/>
                            </Grid>
                        </Button>
                    </StackPanel>

                </Grid>
            </Grid>

            <!-- Resize / Handle -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#DDD" />

            <!-- Main Content -->
            <Grid Grid.Column="2">

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Image View Controls -->
                <Grid Grid.Row="0" Margin="0,8,0,8">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Content="-" Width="40" Margin="4" Command="{Binding ZoomOutCommand}" />
                        <Button Content="+" Width="40" Margin="4" Command="{Binding ZoomInCommand}" />
                        <Button Content="1:1" Width="50" Margin="4" Command="{Binding ZoomActualCommand}" />
                        <Button Content="Fit" Width="50" Margin="4" Command="{Binding FitToWindowCommand}" />
                        <TextBlock Text="{Binding ZoomDisplayText}" VerticalAlignment="Center" Margin="8"/>
                        <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="8,0"/>
                        <CheckBox Name="AutoStretchCheckBox" Content="Auto stretch" IsChecked="{Binding AutoStretch}" 
                                  VerticalAlignment="Center" Margin="8,0" 
                                  ToolTip="Automatically stretch FITS and XISF images to enhance visibility"/>
                    </StackPanel>
                    <Button Content="Full Screen" Width="90" Margin="8,4" 
                            HorizontalAlignment="Right"
                            Command="{Binding EnterFullScreenCommand}"
                            ToolTip="Enter full screen mode (F11)"/>
                </Grid>

                <Grid Grid.Row="1">
                    <Border Background="{DynamicResource ThemeImageAreaBackground}" Margin="8" CornerRadius="4">
                        <Grid>
                            <TextBlock Name="PlaceholderText" Text="Select an image from the file list" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            <ScrollViewer Name="ImageScrollViewer"
                                         Visibility="Collapsed"
                                         HorizontalScrollBarVisibility="{Binding ScrollBarVisibility}"
                                         VerticalScrollBarVisibility="{Binding ScrollBarVisibility}"
                                         HorizontalAlignment="Stretch"
                                         VerticalAlignment="Stretch"
                                         PreviewMouseWheel="ImageScrollViewer_PreviewMouseWheel">
                                <Image Name="DisplayImage"
                                       Stretch="None"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       RenderTransformOrigin="0,0"
                                       MouseLeftButtonDown="DisplayImage_MouseLeftButtonDown"
                                       MouseLeftButtonUp="DisplayImage_MouseLeftButtonUp"
                                       MouseMove="DisplayImage_MouseMove"
                                       RenderOptions.BitmapScalingMode="HighQuality">
                                    <Image.RenderTransform>
                                        <ScaleTransform ScaleX="{Binding ZoomLevel}" ScaleY="{Binding ZoomLevel}" />
                                    </Image.RenderTransform>
                                </Image>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="2" 
                   Background="{DynamicResource ThemeWindowBackground}"
                   BorderBrush="{DynamicResource ThemeBorderBrush}"
                   BorderThickness="0,1,0,0"
                   Padding="8,4">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusBarText}" 
                           FontSize="11"
                           Foreground="{DynamicResource ThemeSecondaryText}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>